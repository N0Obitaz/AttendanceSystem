@page
@model AttendanceSystem.Pages.student_view.GenerateQR.GenerateQRModel
@{
    ViewData["Title"] = "My QR Code";
    // Assuming your Model has a property for the ID to encode
    // If testing without backend data, replace @Model.StudentId with a hardcoded string like "12345"

    var data = Model.Student.StudentId.ToString();
}


<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<div class="min-h-screen bg-gray-50 flex items-center justify-center p-4">



    <div class="bg-white w-full max-w-sm rounded-3xl shadow-2xl border border-gray-100 overflow-hidden relative">

        <div class="h-2 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>

        <div class="p-8 text-center">

            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Get Your QR Code Here</h2>
                <p class="text-sm text-gray-500 mt-1">Download This QR</p>
            </div>

            <div class="relative mx-auto w-64 h-64 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden group">

                <img id="qr-image"
                     src="data:image/png;base64,@Model.QRCodeBase64"
                     class="max-w-sm opacity-0 transform scale-90 transition-all duration-700 ease-out"
                     alt="Student QR" />

                

                <div id="qr-loader" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-10 transition-opacity duration-500">
                    <div class="relative w-16 h-16">
                        <div class="absolute inset-0 border-4 border-gray-100 rounded-full"></div>
                        <div class="absolute inset-0 border-4 border-blue-500 rounded-full border-t-transparent animate-spin"></div>
                    </div>
                    <p class="mt-4 text-sm font-medium text-blue-600 animate-pulse">Generating Secure ID...</p>
                </div>


                <div id="scanner-line" class="absolute inset-x-0 h-1 bg-blue-500/50 shadow-[0_0_10px_rgba(59,130,246,0.5)] opacity-0"></div>
            </div>
            <div class="mt-6">


                <p class="text-lg font-bold text-gray-900">@Model.Student.FirstName</p>
                <p class="text-sm text-gray-400">ID: @Model.Student.StudentId</p>
                <p class="text-sm text-gray-400">Institute: @Model.Student.Institute</p>
                <p class="text-sm text-gray-400">Lastname: @Model.Student.LastName</p>
            </div>

            <div class="mt-8">
                <a href="data:image/png;base64,@Model.QRCodeBase64"
                   download="Student_QR_@Model.Student.StudentId"
                   class="inline-flex items-center gap-2 px-6 py-3 bg-white border-2 border-blue-100 text-blue-600 font-semibold rounded-xl hover:bg-blue-50 hover:border-blue-200 transition-all duration-200 shadow-sm hover:shadow-md group">

                    <i class="bi bi-download group-hover:animate-bounce"></i>

                    <span>Save to Gallery</span>
                </a>

                <p class="mt-3 text-xs text-gray-400">
                    Click to save a copy to your device
                </p>
            </div>

            <div class="mt-6 p-3 bg-blue-50 rounded-lg flex items-start gap-3 text-left">
                <i class="bi bi-info-circle-fill text-blue-500 mt-0.5"></i>
                <p class="text-xs text-blue-700 leading-relaxed">
                    This QR code is valid for today only. Do not share a screenshot of this code with others.
                </p>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        const loader = document.getElementById("qr-loader");
        const qrImage = document.getElementById("qr-image");
        const scannerLine = document.getElementById("scanner-line");

        // SAFETY CHECK: If any element is missing, stop to prevent crashing
        if (!loader || !qrImage || !scannerLine) {
            console.error("One or more elements (qr-loader, qr-image, scanner-line) are missing IDs.");
            return;
        }

        setTimeout(() => {
            // 1. Fade out loader
            loader.classList.add("opacity-0");

            setTimeout(() => {
                // 2. Hide loader fully
                loader.style.display = "none";

                // 3. Reveal Image
                qrImage.classList.remove("opacity-0", "scale-90");
                qrImage.classList.add("opacity-100", "scale-100");

                // 4. Start Scanner
                scannerLine.classList.remove("opacity-0");
                scannerLine.classList.add("animate-scan");

            }, 500);

        }, 2000);
    });
</script>


